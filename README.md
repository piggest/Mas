<p align="center">
  <img src="docs/appicon.png" alt="Mas App Icon" width="128" height="128">
</p>

# Mas - macOS スクリーンショットアプリ

> まるでマスですくうように簡単に正確にスクリーンショットを作成します

![macOS](https://img.shields.io/badge/macOS-13.0+-blue.svg)
![Swift](https://img.shields.io/badge/Swift-5.8-orange.svg)
[![Download](https://img.shields.io/github/v/release/piggest/Mas?label=Download)](https://github.com/piggest/Mas/releases/latest)

## 概要

Mas（Mac Area Screenshot）は、macOS向けのネイティブスクリーンショットアプリケーションです。メニューバーに常駐し、グローバルホットキーで素早くスクリーンショットを撮影できます。撮影後は編集ウィンドウが自動的に表示され、矢印やテキストなどの注釈を追加できます。GIF録画、テキスト認識（OCR）、変化検知やプログラマブルシャッターによる自動撮影にも対応しています。

## 特徴

- **メニューバー常駐**: Dockに表示されず、メニューバーから操作
- **グローバルホットキー**: 他のアプリを使用中でも素早くキャプチャ（カスタマイズ可能）
- **多彩なキャプチャ**: 全画面、範囲選択、キャプチャ枠、パススルー
- **GIF録画**: 画面領域をアニメーションGIFとして録画（再生速度変更・フレーム操作対応）
- **シャッター機能**: 時限・インターバル・変化検知・プログラマブルの4モード
- **豊富な編集ツール**: ペン、マーカー、矢印、四角、丸、テキスト、モザイク、トリミング
- **テキスト認識（OCR）**: スクリーンショット内のテキストを文字単位で選択・コピー
- **ライブラリ**: キャプチャ履歴をサムネイル付きで管理
- **自動保存**: クリップボードへのコピーとファイル保存を自動実行
- **開発者モード**: 自UIをキャプチャに含めるオプション
- **自動更新**: GitHub Releasesから最新版を自動検出・更新
- **Retina対応**: 高解像度ディスプレイに完全対応

## システム要件

- macOS 13.0（Ventura）以上
- 画面収録の権限（初回起動時に許可が必要）

## ダウンロード

[最新版をダウンロード](https://github.com/piggest/Mas/releases/latest)

1. `Mas-x.x.x.dmg`をダウンロード
2. DMGを開いて`Mas.app`を`Applications`フォルダにドラッグ&ドロップ
3. 初回起動時に「開発元が未確認」の警告が出た場合は、システム設定 → プライバシーとセキュリティ → 「このまま開く」をクリック
4. 画面収録の権限を許可

## 使い方

### キャプチャモード

| モード | ショートカット | 説明 |
|--------|---------------|------|
| 全画面 | `⌘⇧3` | メインディスプレイ全体をキャプチャ |
| 範囲選択 | `⌘⇧4` | マウスドラッグで選択した範囲をキャプチャ |
| キャプチャ枠表示 | `⌘⇧6` | 前回の範囲でキャプチャ枠を表示・調整・再キャプチャ |
| GIF録画 | `⌘⇧7` | 画面領域をGIF形式で録画 |
| ライブラリ | `⌘⇧L` | スクリーンショット履歴を表示 |

ショートカットキーは設定画面からカスタマイズできます。

### メニューバーアイコン

- **シングルクリック**: メニューを表示
- **ダブルクリック**: 範囲選択キャプチャを開始

### 範囲選択モード

1. `⌘⇧4`を押すと画面全体にオーバーレイが表示されます
2. マウスをドラッグして範囲を選択
3. マウスを離すとキャプチャが実行されます
4. `ESC`キーでキャンセル

### GIF録画

1. `⌘⇧7`を押すと範囲選択モードに入ります
2. ドラッグで録画範囲を選択すると録画が開始されます
3. 録画範囲の上部にコントロールパネルが表示されます
4. 停止ボタンを押すとGIFファイルが生成されます

録画コントロールウィンドウはGIFに写り込みません。

### シャッター機能

エディターウィンドウを右クリック →「シャッター」から、4種類の自動撮影モードを利用できます。

| モード | 説明 |
|--------|------|
| **時限** | 指定秒数後に1枚キャプチャ |
| **インターバル** | 一定間隔で連続キャプチャ |
| **変化検知** | 画面の変化を監視し、感度以上の変化で自動キャプチャ |
| **プログラマブル** | 複数のステップを組み合わせた自動シーケンス |

#### プログラマブルシャッター

以下のステップを自由に組み合わせてキャプチャシーケンスを構築できます：

| ステップ | 説明 |
|---------|------|
| 撮影 | キャプチャを実行 |
| 待機 | 指定秒数待機 |
| 変化待ち | 監視領域の変化を検知するまで待機 |
| 安定待ち | 画面が安定するまで待機 |
| 繰り返し | 子ステップを指定回数ループ（0で無限） |

- ステップはドラッグ&ドロップで並び替え可能
- 各ステップに監視領域（サブ領域）を指定可能
- プログラムは名前をつけて保存・読み込み可能

### 開発者モード

設定の「開発」タブ（`developerMode` が有効時に表示）から、自UIをキャプチャに含めるオプションを切り替えられます。通常、Masのウィンドウは画面キャプチャから自動的に除外されますが、このオプションを有効にするとMas自体のUIもスクリーンショットに写ります。

### 編集機能

キャプチャ後、編集ウィンドウが表示されます。

1. **編集モードの開始**: 左下の鉛筆アイコンをクリック
2. **フローティングツールバー**: ウィンドウ下部にツールバーが表示されます

#### 利用可能なツール

| ツール | 説明 |
|--------|------|
| 選択 | アノテーションの選択・移動・リサイズ |
| ペン | フリーハンドで線を描画 |
| マーカー | 半透明のハイライト線を描画 |
| 矢印 | テーパー形状の矢印を描画 |
| 四角 | 矩形を描画（枠線または半透明塗りつぶし） |
| 丸 | 円・楕円を描画 |
| テキスト | テキストを挿入 |
| ぼかし | モザイク効果を適用 |
| テキスト選択 | OCRでテキストを認識・選択・コピー |
| トリミング | 画像の一部を切り出し |

#### 編集オプション

- **色の選択**: 10色のプリセットから選択（赤、橙、黄、緑、青、紫、ピンク、黒、白、グレー）
- **サイズ調整**: スライダーで線幅を1〜10の範囲で調整
- **縁取り**: テキストや図形に白い縁取りを追加（どんな背景でも視認性を確保）
- **削除**: 選択中のアノテーションを削除
- **取消**: 最後の操作を取り消し
- **閉じる**: ツールバー右端の×ボタンで編集モードを終了

### エディタウィンドウの操作

- **閉じる / ピン**: 左上ボタンでウィンドウ閉じる・最前面固定
- **再キャプチャ / GIF再録**: 右上のアイコンで同じ範囲を再キャプチャまたはGIF再録
- **パススルー**: ダブルクリックで枠のみ表示 → パススルーボタンでマウスイベント透過
- **ドラッグ&ドロップ**: 右下のアイコンからファイルとしてドラッグ可能
- **右クリック**: コンテキストメニュー（閉じる・コピー・シャッター）
- **シャッター**: 右クリックメニューから時限・インターバル・変化検知・プログラムの各モードにアクセス

### ライブラリ

キャプチャ履歴を管理するウィンドウです。

- サムネイル付きでキャプチャ履歴をグリッド表示
- クリックでエディターウィンドウを開閉
- 星アイコンでお気に入り登録・フィルタリング
- 複数選択と一括削除に対応

## 設定

メニューバーアイコンから「設定」を選択、または `⌘,` で設定画面を開けます。設定は4つのタブに分かれています。

### 一般タブ

#### キャプチャ

| 設定項目 | デフォルト | 説明 |
|---------|-----------|------|
| クリップボードにコピー | ON | キャプチャ時に自動でクリップボードにコピー |
| ファイルに保存 | ON | キャプチャ時に自動でファイルに保存 |
| 保存先 | ~/Pictures/Mas | 自動保存時の保存先フォルダ |
| 保存形式 | PNG | PNG または JPEG |
| JPEG品質 | 90% | JPEG保存時の圧縮品質（10〜100%） |

#### ウィンドウ

| 設定項目 | デフォルト | 説明 |
|---------|-----------|------|
| ピン（最前面表示） | デフォルトOFF | 常にON / 最新のみON / デフォルトOFF |
| ドラッグ成功時に閉じる | ON | ドラッグ&ドロップ成功時にウィンドウを閉じる |

#### メニューバー

| 設定項目 | デフォルト | 説明 |
|---------|-----------|------|
| アイコン | Mas | Mas / モノクロ / カメラ / 枠 の4種類 |

#### その他

| 設定項目 | デフォルト | 説明 |
|---------|-----------|------|
| マウスカーソルを含める | OFF | キャプチャにカーソルを含める |
| キャプチャ時にサウンド再生 | ON | キャプチャ時にサウンドを再生 |
| 開発者モード | OFF | ONにすると「開発」タブが表示される |

#### アップデート

| 設定項目 | デフォルト | 説明 |
|---------|-----------|------|
| 自動アップデート | ON | GitHub Releasesから最新版を自動検出・インストール |
| 今すぐ確認 | — | 手動で更新チェック |

### ショートカットタブ

各アクションのキーバインドを自由にカスタマイズできます。同じキーの重複使用は自動で警告されます。

| 機能 | デフォルト |
|-----|-----------|
| 全画面キャプチャ | `⌘⇧3` |
| 範囲選択 | `⌘⇧4` |
| キャプチャ枠表示 | `⌘⇧6` |
| GIF録画 | `⌘⇧7` |
| ライブラリ | `⌘⇧L` |

### 開発タブ（開発者モード有効時のみ）

- データフォルダの確認・Finderで開く
- 自UIをキャプチャに含める（`NSWindow.sharingType` の切り替え）
- 遅延キャプチャテスト（1〜10秒の遅延後に全画面/範囲選択キャプチャ）

### 情報タブ

アプリ名、バージョン、説明文を表示します。

## CLI

コマンドラインからMasの機能にアクセスできるCLIツールも付属しています。

```bash
# ビルド＆インストール
bash CLI/build.sh
bash CLI/install.sh

# 使用例
mas-cli capture fullscreen
mas-cli capture region
mas-cli capture gif
mas-cli annotate image.png arrow --from 100,200 --to 300,400 --color red
mas-cli ocr screenshot.png
```

詳細は [CLI リファレンス](https://piggest.github.io/Mas/cli/) を参照してください。

## プロジェクト構成

```
Mas/
├── App/
│   ├── AppDelegate.swift           # アプリケーション初期化・ホットキー登録
│   └── HotkeyManager.swift         # グローバルホットキー管理
│
├── Models/
│   ├── CaptureMode.swift           # キャプチャモード定義
│   ├── Screenshot.swift            # スクリーンショットデータモデル
│   └── Annotations/                # 注釈クラス群
│       ├── Annotation.swift
│       ├── ArrowAnnotation.swift
│       ├── EllipseAnnotation.swift
│       ├── FreehandAnnotation.swift
│       ├── HighlightAnnotation.swift
│       ├── MosaicAnnotation.swift
│       ├── RectAnnotation.swift
│       └── TextAnnotation.swift
│
├── Services/
│   ├── ClipboardService.swift      # クリップボード操作
│   ├── FileStorageService.swift    # ファイル保存
│   ├── GifRecordingService.swift   # GIF録画・生成
│   ├── HistoryService.swift        # 履歴管理
│   ├── PermissionService.swift     # 権限管理
│   ├── ScreenCaptureService.swift  # 画面キャプチャ・sharingType制御
│   ├── ShutterService.swift        # シャッター機能（時限・インターバル・変化検知・プログラマブル）
│   ├── TextRecognitionService.swift # テキスト認識（OCR）
│   └── UpdateService.swift         # 自動更新
│
├── ViewModels/
│   ├── CaptureViewModel.swift      # キャプチャ状態管理
│   ├── EditorViewModel.swift       # 編集状態管理
│   └── GifPlayerState.swift        # GIFプレイヤー状態管理
│
├── Views/
│   ├── CanvasView.swift            # 描画キャンバス
│   ├── CaptureFlashView.swift      # キャプチャ時のフラッシュ
│   ├── EditorWindow.swift          # 編集ウィンドウ
│   ├── FloatingToolbarWindow.swift # フローティングツールバー
│   ├── GifPlayerToolbar.swift      # GIFプレイヤーツールバー
│   ├── HistoryWindow.swift         # ライブラリウィンドウ
│   ├── MenuBarView.swift           # メニューバーUI
│   ├── RecordingControlWindow.swift # GIF録画コントロール
│   ├── RegionSelectionOverlay.swift # 範囲選択オーバーレイ
│   ├── ResizableWindow.swift       # リサイズ可能ウィンドウ
│   ├── SettingsWindow.swift        # 設定画面
│   ├── ShutterOptionsPanel.swift   # シャッターパネル（時限・変化検知・プログラム）
│   └── WindowPickerView.swift      # ウィンドウ選択UI
│
├── ScreenshotApp.swift             # メインエントリーポイント
└── Info.plist                      # アプリケーション設定

CLI/
├── mas_cli.swift                   # CLIツール本体
├── build.sh                        # ビルドスクリプト
└── install.sh                      # インストールスクリプト

docs/                               # GitHub Pages ドキュメント
```

## 技術スタック

| 技術 | 用途 |
|-----|------|
| SwiftUI | UI構築 |
| AppKit | ネイティブウィンドウ管理 |
| CoreGraphics | 画像処理・座標計算 |
| CoreImage | モザイク効果（CIPixellate） |
| Vision | テキスト認識（OCR） |
| ImageIO | GIFフレーム操作 |
| Carbon HIToolbox | グローバルホットキー |

## 開発

### 要件

- Xcode 14.3以上
- macOS 13.0以上

### ビルド

```bash
# Debug ビルド
xcodebuild -scheme ScreenshotApp -configuration Debug build

# Release ビルド
xcodebuild -scheme ScreenshotApp -configuration Release build
```

### 権限

アプリケーションは以下の権限を必要とします：

- **画面収録**: スクリーンショットの撮影に必要
  - システム設定 → プライバシーとセキュリティ → 画面収録 で許可

## ドキュメント

- [ユーザーガイド](https://piggest.github.io/Mas/user-guide/) — インストールから基本操作まで
- [アノテーション詳細ガイド](https://piggest.github.io/Mas/annotations/) — 各描画ツールの使い方
- [CLI リファレンス](https://piggest.github.io/Mas/cli/) — コマンドラインツールの使い方

## コントリビューション

バグ報告や機能リクエストは [Issues](https://github.com/piggest/Mas/issues) でお願いします。

## 作者

piggest
